
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  
    <title>First-class Funciton&#39;s Cry | Codingforever</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=3, minimum-scale=1">
    
    <meta name="author" content="zhujiefirst">
    
    <meta name="description" content="what’s First-class function? 没听过啊。小猿我也才前几天头一回听说。直接引用wiki上的原话：In computer science, a programming language is said to have first-class functions if it t">
    
    
    
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="Jay1002008" />
    <meta name="twitter:title" content="First-class Funciton&#39;s Cry | Codingforever" />
      
    
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/pacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/pacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css" type="text/css">

</head>

  <body>
    <header>
      <div>
		
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="Codingforever">Codingforever</a></h1>
				<h2 class="blog-motto">SHUT UP ur fucking mouth! Reading MORE, thinking MORE, coding MORE.</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					
						<li><a href="/">首页</a></li>
					
						<li><a href="/archives">归档</a></li>
					
						<li><a href="/categories">分类</a></li>
					
						<li><a href="/tags">标签</a></li>
					
						<li><a href="/about">关于</a></li>
					
					<li>
					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="text" id="search" name="q" autocomplete="off" maxlength="20" placeholder="搜索" />
						<input type="hidden" name="q" value="site:codingforever.com">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>

    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2013/06/22/-2013-06-22-0-html/" title="First-class Funciton&#39;s Cry" itemprop="url">First-class Funciton&#39;s Cry</a>
  </h1>
  <p class="article-author">By
    
      <a href="http://codingforever.com" title="zhujiefirst">zhujiefirst</a>
    </p>
  <p class="article-time">
    <time datetime="2013-06-21T16:00:00.000Z" itemprop="datePublished">6月 22 2013</time>
    更新日期:<time datetime="2014-12-21T03:47:43.000Z" itemprop="dateModified">12月 21 2014</time>
    
  </p>
</header>
	<div class="article-content">
		
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目录</strong>
		<ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#ROUND_1"><span class="toc-number">1.</span> <span class="toc-text">ROUND 1</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ROUND_2"><span class="toc-number">2.</span> <span class="toc-text">ROUND 2</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ROUND_3"><span class="toc-number">3.</span> <span class="toc-text">ROUND 3</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ROUND_4:"><span class="toc-number">4.</span> <span class="toc-text">ROUND 4:</span></a></li></ol>
		</div>
		
		<p>what’s First-class function? 没听过啊。小猿我也才前几天头一回听说。<br>直接引用wiki上的原话：In computer science, a programming language is said to have first-class functions if it treats functions ad first-class citizens. Specifically, this means the language supports passing functions as arguments to other functions, returning them as the values from other functions, and assigning them to variables or storing them in data structures.</p>
<p>What? 这就是“<strong>一等函数</strong>”啊。以C/C++谋生的小猿感觉有点熟悉啊。这不就是函数指针吗？答案是：NO! 函数指针只是C/C++在其函数类型不是first-class object的情况下而所用的替代品。</p>
<p>那First-class function到底有什么好处呢？说实话，小猿也说不清楚(水平太次)，只能用以 Lua VS C 简略说明下其不同之处，各位看官莫要见笑。</p>
<h2 id="ROUND_1"><strong>ROUND 1</strong></h2>
<p>Lua首先很轻松地支持高阶函数（什么是高阶函数，参见<a href="http://en.wikipedia.org/wiki/Higher-order_function" target="_blank" rel="external">wiki</a>）。</p>
<p>lua版本：</p>
<pre><code><span class="comment">-- higher-order functions: passing functions as arguments</span>
<span class="comment">-- @param f 函数</span>
<span class="comment">-- @param t 函数f的参数</span>
<span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">map</span><span class="params">(f, t)</span></span>
    <span class="keyword">for</span> k, v <span class="keyword">in</span> <span class="built_in">ipairs</span>(t) <span class="keyword">do</span>
        f(v)
    <span class="keyword">end</span>
<span class="keyword">end</span>
</code></pre><p>哈哈，不就是如此嘛，C语言这位大神也可以轻松搞定：</p>
<p>C版本：</p>
<pre><code><span class="comment">// higher-order functions: passing functions as arguments</span>
<span class="keyword">void</span> <span class="built_in">map</span>(<span class="keyword">int</span> (*f)(<span class="keyword">int</span>), <span class="keyword">int</span> arr[], <span class="keyword">int</span> n)
{
    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i) {
        f(arr[i]);
    }
}
</code></pre><h2 id="ROUND_2"><strong>ROUND 2</strong></h2>
<p>lua 轻松搞定匿名函数。</p>
<p>lua版本：</p>
<pre><code><span class="comment">-- anonymous and nested functions</span>
map(<span class="function"><span class="keyword">function</span><span class="params">(v)</span></span> <span class="built_in">print</span>(v) <span class="keyword">end</span>, { <span class="number">1</span>, <span class="number">2</span> }) <span class="comment">-- function map is defined in ROUND 1</span>
</code></pre><p>C大神流了点汗，也使出相应招术。</p>
<p>C版本：</p>
<pre><code>// <span class="keyword">not</span> support anonymous <span class="keyword">and</span> nested functions, have to <span class="keyword">bind</span> it to a name instead
<span class="keyword">int</span> <span class="keyword">print</span>(<span class="keyword">int</span> v)
{
    <span class="keyword">printf</span>(<span class="string">"<span class="variable">%d</span>"</span>, v);
}
<span class="keyword">int</span> main()
{
    <span class="keyword">int</span> arr = { <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span> };
    <span class="keyword">map</span>(<span class="keyword">print</span>, arr, sizeof(arr)/sizeof(<span class="keyword">int</span>));
    <span class="keyword">return</span> <span class="number">0</span>;
}
</code></pre><h2 id="ROUND_3"><strong>ROUND 3</strong></h2>
<p>lua 使用<a href="http://en.wikipedia.org/wiki/Closure_%28computer_science%29" target="_blank" rel="external">cloures</a>绝招。</p>
<p>lua版本：</p>
<pre><code><span class="comment">-- non-local variables and closures</span>
<span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">main</span><span class="params">()</span></span>
    <span class="keyword">local</span> offset = <span class="number">10</span>
    <span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">map</span><span class="params">(f, t)</span></span>
        <span class="keyword">for</span> k, v <span class="keyword">in</span> <span class="built_in">ipairs</span>(t) <span class="keyword">do</span>
            f(v)
        <span class="keyword">end</span>
    <span class="keyword">end</span>
    map(<span class="function"><span class="keyword">function</span><span class="params">(v)</span></span> offset = offset + v <span class="built_in">print</span>(offset) <span class="keyword">end</span>, { <span class="number">1</span>, <span class="number">2</span> })
<span class="keyword">end</span>
main()
</code></pre><p>C虽然没有明显的吃亏，但已然快招架不住。</p>
<p>C版本：</p>
<pre><code><span class="keyword">typedef</span> <span class="keyword">struct</span> {
    <span class="keyword">void</span> (*f) (<span class="keyword">int</span>);
    <span class="keyword">int</span>* offset;
} closure_t;
<span class="keyword">void</span> print(<span class="keyword">int</span> v)
{
    <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, v);
}
<span class="keyword">void</span> <span class="built_in">map</span>(closure_t closure, <span class="keyword">int</span> arr[], <span class="keyword">int</span> n)
{
    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i) {
        *(closure.offset) += arr[i];
        closure.f(*(closure.offset));
    }
}
<span class="keyword">int</span> main()
{
    <span class="keyword">int</span> offset = <span class="number">10</span>;
    closure_t closure = { print, &amp;offset };
    <span class="keyword">int</span> arr[] = { <span class="number">1</span>, <span class="number">2</span> };
    <span class="built_in">map</span>(closure, arr, <span class="keyword">sizeof</span>(arr) / <span class="keyword">sizeof</span>(<span class="keyword">int</span>));
    <span class="keyword">return</span> <span class="number">0</span>;
}
</code></pre><h2 id="ROUND_4:"><strong>ROUND 4:</strong></h2>
<p>lua又使用一招返回函数:</p>
<p>Lua版本：</p>
<pre><code><span class="comment">-- higher-order functions: returning functions as reuslt</span>
<span class="comment">-- Assigning functions to variables</span>
<span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">getPrintFunc</span><span class="params">()</span></span>
    <span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">myPrint</span><span class="params">(v)</span></span>
        <span class="built_in">print</span>(v)
    <span class="keyword">end</span>
    <span class="keyword">return</span> myPrint
<span class="keyword">end</span>
<span class="keyword">local</span> func = getPrintFunc()
func(<span class="number">1</span>)
</code></pre><p>C以它老江湖的经验接住了此招。</p>
<p>C版本：</p>
<pre><code>typedef void (*f)(int);
void <span class="built_in">print</span>(int v)
{
    printf(<span class="string">"%d\n"</span>, v);
}
f getPrintFunc()
{
    <span class="keyword">return</span> <span class="built_in">print</span>;
}
int main()
{
    f <span class="func"><span class="keyword">func</span></span> = getPrintFunc();
    <span class="func"><span class="keyword">func</span><span class="params">(1)</span></span>;
    <span class="keyword">return</span> <span class="number">0</span>;
}
</code></pre><p>比武结束，当然以已之长攻他之短并不是十分光彩的事，但是这里也是为了说明理解First-class function的方便之处。其实First-class function在高阶函数中还是很有用的，当然实际工作中，如果用到闭包、匿名函数则其方便之处不言而喻。当然，具体情况还是具体分析，我们是辩证法的推崇者嘛。</p>
  
	</div>
		<footer class="article-footer clearfix">

  <div class="article-tags">
  
  <span></span> <a href="/tags/高阶函数/">高阶函数</a>
  </div>


<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/编程思维/">编程思维</a>
</div>



<div class="article-share" id="share">

  <div data-url="http://codingforever.com/2013/06/22/-2013-06-22-0-html/" data-title="First-class Funciton&#39;s Cry | Codingforever" data-tsina="null" class="share clearfix">
  </div>

</div>
</footer>   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/2013/06/23/-2013-06-23-0-html/" title="编程语言与编程思维杂感">
  <strong>PREVIOUS:</strong><br/>
  <span>
  编程语言与编程思维杂感</span>
</a>
</div>


<div class="next">
<a href="/2013/03/25/-2013-03-25-0-html/"  title="原地排序">
 <strong>NEXT:</strong><br/> 
 <span>原地排序
</span>
</a>
</div>

</nav>

	
<section class="comment">
	<div class="ds-thread"></div>
</section>

</div>  
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目录</strong>
  <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#ROUND_1"><span class="toc-number">1.</span> <span class="toc-text">ROUND 1</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ROUND_2"><span class="toc-number">2.</span> <span class="toc-text">ROUND 2</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ROUND_3"><span class="toc-number">3.</span> <span class="toc-text">ROUND 3</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ROUND_4:"><span class="toc-number">4.</span> <span class="toc-text">ROUND 4:</span></a></li></ol>
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  
  <div class="archiveslist">
    <p class="asidetitle"><a href="/archives">归档</a></p>
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/01/">January 2015</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/12/">December 2014</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/11/">November 2014</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/08/">August 2014</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/07/">July 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/07/">July 2013</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/06/">June 2013</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/03/">March 2013</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/09/">September 2012</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/12/">December 2011</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/10/">October 2011</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/06/">June 2011</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/05/">May 2011</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/09/">September 2010</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/08/">August 2010</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/07/">July 2010</a><span class="archive-list-count">1</span></li></ul>
  </div>


  
<div class="categorieslist">
	<p class="asidetitle">分类</p>
		<ul>
		
			<li><a href="/categories/c-c/" title="c/c++">c/c++<sup>5</sup></a></li>
		
			<li><a href="/categories/golang/" title="golang">golang<sup>2</sup></a></li>
		
			<li><a href="/categories/lisp/" title="lisp">lisp<sup>1</sup></a></li>
		
			<li><a href="/categories/lua/" title="lua">lua<sup>1</sup></a></li>
		
			<li><a href="/categories/服务器编程/" title="服务器编程">服务器编程<sup>3</sup></a></li>
		
			<li><a href="/categories/杂感/" title="杂感">杂感<sup>5</sup></a></li>
		
			<li><a href="/categories/游戏开发/" title="游戏开发">游戏开发<sup>4</sup></a></li>
		
			<li><a href="/categories/算法/" title="算法">算法<sup>15</sup></a></li>
		
			<li><a href="/categories/编程思维/" title="编程思维">编程思维<sup>3</sup></a></li>
		
			<li><a href="/categories/设计模式/" title="设计模式">设计模式<sup>2</sup></a></li>
		
		</ul>
</div>


  
<div class="tagslist">
	<p class="asidetitle">标签</p>
		<ul class="clearfix">
		
			<li><a href="/tags/openGL/" title="openGL">openGL<sup>4</sup></a></li>
		
			<li><a href="/tags/pprof/" title="pprof">pprof<sup>1</sup></a></li>
		
			<li><a href="/tags/union-find/" title="union-find">union-find<sup>4</sup></a></li>
		
			<li><a href="/tags/代码质量/" title="代码质量">代码质量<sup>3</sup></a></li>
		
			<li><a href="/tags/元编程/" title="元编程">元编程<sup>1</sup></a></li>
		
			<li><a href="/tags/内存管理/" title="内存管理">内存管理<sup>1</sup></a></li>
		
			<li><a href="/tags/基础/" title="基础">基础<sup>1</sup></a></li>
		
			<li><a href="/tags/小技巧/" title="小技巧">小技巧<sup>1</sup></a></li>
		
			<li><a href="/tags/性能/" title="性能">性能<sup>4</sup></a></li>
		
			<li><a href="/tags/排序/" title="排序">排序<sup>8</sup></a></li>
		
			<li><a href="/tags/网络I-O/" title="网络I/O">网络I/O<sup>1</sup></a></li>
		
			<li><a href="/tags/设计/" title="设计">设计<sup>7</sup></a></li>
		
			<li><a href="/tags/面向对象/" title="面向对象">面向对象<sup>2</sup></a></li>
		
			<li><a href="/tags/面试题/" title="面试题">面试题<sup>4</sup></a></li>
		
			<li><a href="/tags/高阶函数/" title="高阶函数">高阶函数<sup>1</sup></a></li>
		
		</ul>
</div>


</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> Hello world! I&#39;m zhujiefirst in Tencent. <br/>
			从小我就有个梦想，就是当一名合格的程序员。我不是码畜，我为自己带盐！</p>
	</section>
	 
	<div class="social-font clearfix">
		
		<a href="http://weibo.com/2421642590" target="_blank" title="weibo"></a>
		
		
		<a href="https://twitter.com/Jay1002008" target="_blank" title="twitter"></a>
		
		
		<a href="https://github.com/zhujiefirst" target="_blank" title="github"></a>
		
		
		
	</div>
		<p class="copyright">Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/A-limon/pacman" target="_blank" title="Pacman">Pacman</a> © 2015 
		
		<a href="http://codingforever.com" target="_blank" title="zhujiefirst">zhujiefirst</a>
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.1.0.min.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else
    {
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      h  = $('article h2')
      ah = $('article h2'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  if(ah.length==0){
    t.css('display','none');
  }else{
    c.click(function(){
      ta.css('display', 'block').addClass('fadeIn');
    });
    o.click(function(){
      ta.css('display', 'none');
    });
    $(window).scroll(function(){
      ta.css("top",Math.max(140,320-$(this).scrollTop()));
    });
  };
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina');
  var html = [
  '<a href="#" class="overlay" id="qrcode"></a>',
  '<div class="qrcode clearfix"><span>扫描二维码分享到微信朋友圈</span><a class="qrclose" href="#share"></a><strong>Loading...Please wait</strong><img id="qrcode-pic" data-src="http://s.jiathis.com/qrcode.php?url=' + encodedUrl + '"/></div>',
  '<a href="#textlogo" class="article-back-to-top" title="Top"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="QRcode"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="Weibo"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);
  $('.article-share-qrcode').click(function(){
    var imgSrc = $('#qrcode-pic').attr('data-src');
    $('#qrcode-pic').attr('src', imgSrc);
    $('#qrcode-pic').load(function(){
        $('.qrcode strong').text(' ');
    });
  });
});     
</script>


<script type="text/javascript">
  var duoshuoQuery = {short_name:"null"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script> 





  </body>
</html>
